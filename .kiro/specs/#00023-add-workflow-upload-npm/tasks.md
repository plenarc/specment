# 実装計画

## 概要

メインブランチへのプルリクエストマージ時に自動的にnpmパッケージを公開するGitHub Actionsワークフローの実装計画です。既存のChangesetsワークフローと統合し、関連ドキュメントの更新も含めて、完全な自動化ソリューションを段階的に実装します。

## タスクリスト

- [x] 1. GitHub Actionsワークフローファイルの基本構造作成
  - `.github/workflows/npm-publish.yaml`ファイルの作成
  - メインブランチへのpushトリガーの設定
  - 基本的なジョブ構造とステップの定義
  - Ubuntu最新版での実行環境設定
  - _要件: 1.1, 1.2, 1.3_

- [x] 2. Node.js環境とパッケージマネージャーのセットアップ
  - Node.js LTS版のセットアップアクション追加
  - pnpmパッケージマネージャーのインストール
  - 依存関係のキャッシュ設定
  - 環境変数の設定
  - _要件: 4.1, 4.2_

- [x] 3. ビルドとテストステップの実装
  - 依存関係インストールステップの追加
  - ビルドプロセス実行ステップの追加
  - テストスイート実行ステップの追加
  - ビルド/テスト失敗時のワークフロー停止処理
  - _要件: 4.1, 4.2, 4.3, 4.4_

- [x] 4. Changesets検出と検証ロジックの実装
  - Changesets存在確認ステップの追加
  - Changesets設定ファイルの検証
  - Changesets不存在時のワークフロースキップ処理
  - 検証エラー時の適切なエラーメッセージ出力
  - _要件: 3.1, 3.2_

- [x] 5. npm認証とセキュリティ設定の実装

  - GitHub SecretsからのNPM_TOKEN取得
  - npm認証設定の追加
  - 認証失敗時のエラーハンドリング
  - セキュアなログ出力（機密情報の除外）
  - _要件: 2.1, 2.2, 2.3_

- [x] 6. バージョン更新とnpm公開ステップの実装
  - Changesetsに基づくバージョン更新処理
  - package.jsonファイルのバージョン更新
  - npm publishコマンドの実行
  - 公開失敗時のリトライ機能（最大3回）
  - _要件: 1.3, 3.3, 3.4_

- [x] 7. Gitタグ作成とリリース情報の記録
  - 新しいバージョンのGitタグ作成
  - タグ作成時のリリースノート追加
  - 公開されたパッケージ情報のログ出力
  - GitHub Releasesとの連携設定
  - _要件: 3.4, 5.2_

- [x] 8. 包括的なエラーハンドリングの実装
  - 各ステップでの詳細なエラーログ出力
  - エラー種別に応じた適切なメッセージ表示
  - 失敗時の手動リリース手順案内
  - ワークフロー実行状況の可視化
  - _要件: 2.2, 5.1, 5.3, 5.4_

- [x] 9. CHANGESET_WORKFLOW.mdドキュメントの更新
  - 自動化されたワークフローの説明セクション追加
  - 手動プロセスと自動プロセスの比較表作成
  - 新しいワークフローでのChangeset作成手順更新
  - トラブルシューティングセクションの追加
  - _要件: 6.1, 6.3_

- [x] 10. RELEASE_PROCESS.mdドキュメントの更新
  - 自動リリースプロセスの詳細説明追加
  - 緊急時の手動リリース手順の記載
  - リリース後の確認手順の更新
  - ベストプラクティスとガイドラインの追加
  - _要件: 6.2, 6.4_

- [x] 11. ワークフローのテストと検証
  - テスト用ブランチでのワークフロー実行テスト
  - 各種エラーシナリオの検証
  - Changesets統合の動作確認
  - npm公開プロセスの検証（テストレジストリ使用）
  - _要件: 1.1, 1.2, 1.3, 1.4_

- [x] 12. セキュリティ設定の最終確認と最適化
  - NPM_TOKENの権限設定確認
  - ログ出力での機密情報漏洩チェック
  - ワークフロー権限の最小化設定
  - セキュリティベストプラクティスの適用
  - _要件: 2.1, 2.2, 2.3_

- [x] 13. パフォーマンス最適化と最終調整
  - 依存関係キャッシュの最適化
  - 並列実行可能なステップの特定と実装
  - 不要なステップのスキップ条件追加
  - ワークフロー実行時間の最適化
  - _要件: 5.1, 5.2, 5.3_

- [x] 14. 統合テストと本番環境での動作確認
  - 実際のプルリクエストマージでの動作テスト
  - 公開されたパッケージの検証
  - ドキュメントの正確性確認
  - チーム内での使用方法の共有と確認
  - _要件: 1.1, 1.2, 1.3, 1.4, 6.1, 6.2, 6.3, 6.4_

- [x] 15. 全package.jsonのバージョン更新
  - ルートpackage.jsonを0.1.8に更新
  - packages/specment/package.jsonを0.1.8に更新
  - apps/website/package.jsonを0.1.8に更新
  - バージョン整合性の確認
